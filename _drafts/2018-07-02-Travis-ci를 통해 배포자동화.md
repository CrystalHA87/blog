---
title: "Travis-ci를 이용해 배포 자동화 시키기"
categories: 
  - blogging
last_modified_at: 2018-07-02T13:10:37+09:00
toc: true
toc_sticky: true
---

저번 포스팅에서는 minimal-mistake 테마를 이용해서 기본적인 설정을 했었습니다.

이번 포스팅에서는 minimal-mistake 테마에서 Travis-ci라는 서비스를 이용하여 Github에 push하면 자동으로 build 및 gh-pages 브랜치에 push 하는 방법에 대하여 포스팅 하고자 합니다.

travis-ci 부분의 내용은 대부분 [jasper2](https://github.com/jekyller/jasper2)에서 사용한 코드를 참고 하였습니다.
{: .notice}



## _config.yml 수정하기
먼저 상단에 위치한 `theme` / `remote_theme` 부분을 확인합니다.

travis-ci를 쓸경우 
```yml
 theme                  : "minimal-mistakes-jekyll"
#remote_theme           : "mmistakes/minimal-mistakes"
```
위와 같이 remote_theme는 주석처리 하도록 합니다.

반대로 github pages 를 사용할 경우, theme를 주석 처리 해주시면 됩니다.

그 다음 아래의 코드를 추가 후 자신의 환경에 맞게 수정해 줍니다.

```yml
# Settings for builing master branch with travis-ci
# with jekyll-travis

# Settings for deploy rake task
# Username and repo of Github repo, e.g.
# https://github.com/USERNAME/REPO.git
# username defaults to ENV['GIT_NAME'] used by Travis
# repo defaults to USERNAME.github.io
# Branch defaults to "source" for USERNAME.github.io
# or "master" otherwise
safe: False
lsi: False
username: Superman #Github username
repo: my-blog #Github repo
branch: master
relative_source: ../my-blog/
destination: ../posts
production_url:  https://blog.imreplay.xyz # https://[username].github.io/[repo] or Your Custom URL
source_url:  https://github.com/imreplay/blog/ # Github repo URL
```

## .travis.yml 수정하기

다음으로 .travis.yml을 수정해줍니다.


```yml
language: ruby
cache: bundler

install:
  # Install Jekyll and dependencies
  - bundle install

script:
  - bundle exec rake site:deploy --quiet
branches:
  only:
    # Change this to gh-pages if you're deploying using the gh-pages branch
    - master
rvm:
 - 2.4.2

# Generate your secure token with the travis gem:
# get Github token from your Travis CI profile page
# gem install travis
# GH_TOKEN from https://github.com/settings/tokens
# travis encrypt 'GIT_NAME="YOUR_USERNAME" GIT_EMAIL="YOUR_EMAIL" GH_TOKEN=YOUR_TOKEN'

env:
  global:
    secure: "your Secure Key"
```

이제 secure 에 들어갈 값을 구해야 합니다.

## travis-ci 연결하고 토큰 발급 받기

[travis-ci.org](https://travis-ci.org/) 에 접속하여 github 계정으로 로그인 합니다.

travis-ci 서비스에서 github에 push 할 수 있게 Token을 발급해줍니다.

토큰은 Setting - Developer settings - Personal access tokens 에서 발급받을 수 있습니다.

Generate new Token을 눌러 새로운 토큰을 만들어 줍니다.

description을 쓴 후 Select scopes 에서 `repo` 를 선택한 후 

Generate Token 을 누르면 토큰을 발급받을 수 있습니다.

해당 토큰을 바로 사용할 경우 보안상의 위험이 있어, 암호화 하여 사용합니다.

## secure 값 발급 받기

이번 부분은 Command 환경에서 작업합니다.

저는 우분투 환경에서 작업하였습니다.

ruby가 설치되지 않은경우 ruby를 먼저 설치해 줍니다.

그 후 프로젝트 디렉토리로 이동후 진행 합니다. 아직 clone 하지 않았을 경우 clone 하여 해당 디렉토리로 이동합니다.

> git clone https://github.com/[username]/[repo]

먼저 travis gem을 설치해 줍니다.

> gem install travis

설치를 마친 후 아래 명령어를 자신에게 맞게 수정하여 입력합니다.

`travis encrypt 'GIT_NAME="YOUR_USERNAME" GIT_EMAIL="YOUR_EMAIL" GH_TOKEN=YOUR_TOKEN'`

GIT_NAME에는 Github 사용자 이름, GIT_EMAIL에는 Github에서 사용하는 email 주소, GH_TOKEN에는 위에서 발급받았던 토큰 값을 입력해줍니다.

따옴표 잘못 된것 아니니 그대로 사용하시면 됩니다!!
{: .notice}

결과 값으로 나오는 값을 `.travis.yml` 파일의 secure 부분에 붙여넣어줍니다.